var NORMAL_MAP=1;var HYBRID_MAP=2;var OFFLINE_MAP=3;var TERRAIN_MAP=4;var _Label=function(arg){this.setValues(arg);this.labelClass=arg.labelClass||"markerLabel";this.labelOffset=arg.labelOffset||new google.maps.Size(0,0);this.id=arg.id||0;var span=this.span_=document.createElement('span');span.style.cssText='position: relative; left: -50%; top: -4px; white-space: nowrap;padding: 1px;  font-size:12px;color:blue;font-family: 黑体;';var div=this._div=document.createElement('div');div.className=this.labelClass;div.appendChild(span);div.style.cssText='position: absolute; display: none'}_Label.prototype=new google.maps.OverlayView;_Label.prototype.getId=function(){return this.id}_Label.prototype.onAdd=function(){var pane=this.getPanes().overlayLayer;pane.appendChild(this._div);var me=this;this.listeners_=[google.maps.event.addListener(this,'position_changed',function(){me.draw()}),google.maps.event.addListener(this,'text_changed',function(){me.draw()})]};_Label.prototype.onRemove=function(){this._div.parentNode.removeChild(this._div);for(var i=0,I=this.listeners_.length;i<I;++i){google.maps.event.removeListener(this.listeners_[i])}};_Label.prototype.draw=function(){var projection=this.getProjection();var position=projection.fromLatLngToDivPixel(this.get('position'));var div=this._div;div.style.left=(position.x)+'px';div.style.top=(position.y)+'px';div.style.display='block';this.span_.innerHTML=this.get('text').toString()};document.write('<style type="text/css">div .markerLabel {	display: block;	padding-top: 9px;	text-align: center;	width: 32px;letter-spacing: 0px;	font-size: 10px;font-family: Arial;}</style>');var mapHelper=function(){google.maps.LatLng.prototype.distanceFrom=function(latlng){var lat=[this.lat(),latlng.lat()]var lng=[this.lng(),latlng.lng()]var R=6378137;var dLat=(lat[1]-lat[0])*Math.PI/180;var dLng=(lng[1]-lng[0])*Math.PI/180;var a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(lat[0]*Math.PI/180)*Math.cos(lat[1]*Math.PI/180)*Math.sin(dLng/2)*Math.sin(dLng/2);var c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));var d=R*c;return Math.round(d)}google.maps.Marker.prototype.id=0;google.maps.Marker.prototype.getId=function(){return this.id}google.maps.Marker.prototype.distanceFrom=function(marker){return this.getPosition().distanceFrom(marker.getPosition())}google.maps.Marker.prototype._timerId=0;google.maps.Marker.prototype._flickerState=true;google.maps.Marker.prototype._iconTmpPath="";google.maps.Marker.prototype.setIconTmpPath=function(icon){this._iconTmpPath=icon}google.maps.Marker.prototype.setFlicker=function(flicker,flickerIcon,interval){var g=this;flickerIcon=flickerIcon||"";if(flicker){g.setIcon(flickerIcon)}else{g.setIcon(g._iconTmpPath)}}google.maps.Polyline.prototype.id=0;google.maps.Polyline.prototype.getId=function(){return this.id}google.maps.Polyline.prototype.getLength=function(){var d=0;var path=this.getPath();var latlng;for(var i=0;i<path.getLength()-1;i++){latlng=[path.getAt(i),path.getAt(i+1)];d+=latlng[0].distanceFrom(latlng[1])}return d}google.maps.Polyline.prototype._timerId=0;google.maps.Polyline.prototype._flickerState=true;google.maps.Polyline.prototype._colorTmp="#0000FF";google.maps.Polyline.prototype.setFlicker=function(flicker,flickerColor,interval){var g=this;flickerColor=flickerColor||"#FF0000";if(flicker){window.clearTimeout(g._timerId);var intervalTime=interval||1000;g._timerId=window.setInterval(function(){if(g._flickerState){g.setOptions({strokeColor:flickerColor})}else{g.setOptions({strokeColor:g._colorTmp})}g._flickerState=!g._flickerState},intervalTime)}else{window.clearTimeout(g._timerId)}}}Array.prototype.remove=function(id){for(var i=0;i<this.length;i++){if(this[i].id==id){this[i].setMap(null);this.splice(i,1);return}}}Array.prototype.getItem=function(id){for(var i=0;i<this.length;i++){if(this[i].id==id){return this[i]}}}Array.prototype.clearItem=function(obj){var isNullObj=false;if(typeof obj===undefined||obj==null)isNullObj=true;for(var i=0;i<this.length;i++){if(isNullObj){this[i].setMap(null);this[i]=null}else if(obj===this[i]){this[i].setMap(null);this.splice(i,1);return}}if(isNullObj)this.length=0}mapHelper.prototype={map:null,geocoder:null,minLevel:0,maxLevel:21,initMap:function(mapCanvas,myOptions){if(this.isUndefined(mapCanvas))mapCanvas=document.getElementById("map_canvas");if(this.isUndefined(myOptions)){myOptions={zoom:8,center:new Array(117.209888,31.852471),disableDefaultUI:false,scaleControl:true,mapTypeControl:true,navigationControl:false,mapType:NORMAL_MAP}}myOptions.center=new google.maps.LatLng(myOptions.center[1],myOptions.center[0]);this.map=new google.maps.Map(mapCanvas);myOptions.mapTypeId=this.__convertMapType(myOptions.mapTypeId,myOptions.mapPath,myOptions.mapFileExt);this.map.setOptions(myOptions);this.geocoder=new google.maps.Geocoder();return this.map},__convertMapType:function(type,mapPath,mapFileExt){var maptilePath=mapPath||"maptile/googlemaps/roadmap/";var mapFileExt=mapFileExt||"png";switch(type){case NORMAL_MAP:return google.maps.MapTypeId.ROADMAP;break;case HYBRID_MAP:return google.maps.MapTypeId.HYBRID;break;case TERRAIN_MAP:return google.maps.MapTypeId.TERRAIN;break;case OFFLINE_MAP:var gmapsMapTypeId="google_offline";this.map.mapTypes.set(gmapsMapTypeId,this.__createMapType("离线地图",maptilePath,mapFileExt));this.map.mapTypeControlOptions={mapTypeIds:[gmapsMapTypeId]};return gmapsMapTypeId;break}return google.maps.MapTypeId.ROADMAP},isUndefined:function(obj){if(typeof obj===undefined)return true;if(obj==null)return true;return false},isFunction:function(func){if(!this.isUndefined(func)){if(func.constructor==Function)return true}return false},__lngLatToLatLng:function(ary){var path=Array();for(i=0;i<ary.length;i++){path[i]=new google.maps.LatLng(parseFloat(ary[i][1]),parseFloat(ary[i][0]))}return path},__zoomMap:function(step){var g=this;if(g.map){var zoomLevel=g.map.getZoom();zoomLevel+=step;g.map.setZoom(parseInt(zoomLevel));if(zoomLevel==g.minLevel){alert("地图区域已缩至最小")}else if(zoomLevel==g.maxLevel){alert("地图区域已放至最大")}}},__lines:new Array(),__polys:new Array(),__dirDisplays:new Array(),__mapsEvents:new Array(),__markers:new Array(),__labels:new Array(),__markerPoint:function(latlng,title,icon,id){var g=this;var n=g.__markers.length;if(g.isUndefined(id))id=0;if(g.isUndefined(title))title="";if(g.isUndefined(icon))icon="";if(id>0){for(var i=0;i<g.__markers.length;i++){if(g.__markers[i].id.toString()==id.toString()){g.__markers[i].setOptions({position:latlng,title:title,icon:icon,_iconTmpPath:icon});return}}}var marker=new google.maps.Marker({map:g.map,position:latlng,title:title,icon:icon,_iconTmpPath:icon});marker.id=id;g.__markers.push(marker);return marker},__createMapType:function(name,mapTilePath,mapFileExt){var getTileUrl=function(coord,zoom){var numTiles=(1<<zoom);if((coord.x<0)||(coord.x>=numTiles)||(coord.y<0)||(coord.y>=numTiles)){return null}return mapTilePath+zoom+"/"+coord.x+"/"+coord.y+"."+mapFileExt};var bIsPng=mapFileExt=="png"?true:false;var imageMapTypeOptions={"name":name,"alt":"显示本地地图数据","tileSize":new google.maps.Size(256,256),"maxZoom":16,"minZoom":1,"getTileUrl":getTileUrl,"isPng":bIsPng,"opacity":1.0};return new google.maps.ImageMapType(imageMapTypeOptions)},bindInstanceEvent:function(instance,eventname,callback){var g=this;if(!g.isUndefined(instance)&&!g.isUndefined(eventname)&&!g.isUndefined(callback)){var mapsEvent=new google.maps.event.addListener(instance,eventname,function(event){callback(event,g.map,instance)});g.__mapsEvents.push(mapsEvent);return mapsEvent}return null},clearInstanceEvent:function(instance,eventName){if(this.isUndefined(eventName))google.maps.event.clearInstanceListeners(instance);else google.maps.event.clearListeners(instance,eventName)},removeEvent:function(event){google.maps.event.removeListener(event)},clearEvents:function(){for(var i=0;i<this.__mapsEvents.length;i++){google.maps.event.removeListener(this.__mapsEvents[i]);this.__mapsEvents[i]=null}this.__mapsEvents=[]},setZoom:function(level){level=parseInt(level);if(level<this.minLevel||level>this.maxLevel){alert("指定地图缩放级别不正确");return false}this.map.setZoom(level);return true},getZoom:function(){return this.map.getZoom()},zoomIn:function(){this.__zoomMap(1)},zoomOut:function(){this.__zoomMap(-1)},movePoint:function(lng,lat,level){lat=parseFloat(lat);lng=parseFloat(lng);var latlng=new google.maps.LatLng(lat,lng);this.map.setCenter(latlng);if(!this.isUndefined(level)&&level!="")this.setZoom(level)},findPoint:function(address){var g=this;g.geocoder.geocode({'address':address,'region':'CN'},function(results,status){if(status==google.maps.GeocoderStatus.OK){var latlng=results[0].geometry.location;g.map.setCenter(latlng);g.__markerPoint(latlng,address)}else{alert("地理位置不正确,错误信息:"+status)}})},markerPoint:function(arg){var g=this;var lat=arg.lat;var lng=arg.lng;var title=arg.title;var icon=arg.icon;var latlng=arg.latlng||new google.maps.LatLng(lat,lng);var id=arg.id||0;var marker=g.__markerPoint(latlng,title,icon,id);return marker},getMarkers:function(){return this.__markers},clearMarker:function(marker){this.__markers.clearItem(marker)},removeMarker:function(id){this.__markers.remove(id)},getMarker:function(id){return this.__markers.getItem(id)},DrawLabel:function(arg){var g=this;var lat=arg.lat;var lng=arg.lng;var text=arg.text||"";var latlng=arg.latlng||new google.maps.LatLng(lat,lng);var labelClass=arg.labelClass||"markerLabel";var labelOffset=arg.labelOffset||new google.maps.Size(0,0);var id=arg.id||0;if(id>0){for(var i=0;i<this.__labels.length;i++){if(g.__labels[i].id.toString()==id.toString()){g.__labels[i].setValues({position:latlng,text:text});return}}}var label=new _Label({map:g.map,position:latlng,text:text,labelClass:labelClass,labelOffset:labelOffset,id:id});g.__labels.push(label);return label},getLabels:function(){return this.__labels},clearLabel:function(){this.__labels.clearItem()},removeLabel:function(id){this.__labels.remove(id)},polyline:function(arg){var g=this;var ds=arg.dots;var c=arg.color||"#FF0000";var o=arg.opacity||1.0;var w=arg.weight||2;var path=g.__lngLatToLatLng(ds);var id=arg.id||0;if(id>0){for(var i=0;i<g.__lines.length;i++){if(g.__lines[i].id.toString()==id.toString()){g.__lines[i].setPath(path);g.__lines[i].setOptions({strokeColor:c,strokeOpacity:parseFloat(o),strokeWeight:parseInt(w),_colorTmp:c});return}}}var line=new google.maps.Polyline({path:path,strokeColor:c,strokeOpacity:parseFloat(o),strokeWeight:parseInt(w),_colorTmp:c});line.setMap(g.map);line.id=id;g.__lines.push(line);return line},clearLine:function(line){this.__lines.clearItem(line)},removeLine:function(id){this.__lines.remove(id)},getLine:function(id){return this.__lines.getItem(id)},polygon:function(arg){var g=this;var ds=arg.dots;var sc=arg.color||"#FF0000";var so=arg.opacity||1.0;var sw=arg.weight||1;var fc=arg.fillcolor||"#FF0000";var fo=arg.fillopacity||0.35;var path=g.__lngLatToLatLng(ds);var polygon=new google.maps.Polygon({paths:path,strokeColor:sc,strokeOpacity:parseFloat(so),strokeWeight:parseInt(sw),fillColor:fc,fillOpacity:parseFloat(fo)});polygon.setMap(g.map);g.__polys.push(polygon);return polygon},circle:function(arg){var g=this;var lat=arg.lat;var lng=arg.lng;var radius=arg.radius||100;var sc=arg.color||"#FF0000";var so=arg.opacity||1.0;var sw=arg.weight||1;var fc=arg.fillcolor||"#FF0000";var fo=arg.fillopacity||0.35;var circleOptions={strokeColor:sc,strokeOpacity:parseFloat(so),strokeWeight:parseInt(sw),fillColor:fc,fillOpacity:parseFloat(fo),center:new google.maps.LatLng(lat,lng),radius:parseInt(radius)};circle=new google.maps.Circle(circleOptions);circle.setMap(g.map);g.__polys.push(circle);return circle},getPolys:function(){return this.__polys},clearPoly:function(poly){this.__polys.clearItem(poly)},navigation:function(arg){var g=this;var mode=arg.mode||"DRIVING";var origin=arg.from;var destination=arg.to;var highways=arg.highways;var tolls=arg.tolls;var dirPanel=arg.dirPanel;var locations=arg.locations;var draggable=arg.draggable||false;var waypoints=new Array();var avoidHighways=true,avoidTolls=true;if(!g.isUndefined(highways))avoidHighways=!highways;if(!g.isUndefined(tolls))avoidTolls=!tolls;if(typeof(locations)=="object"){var n=locations.length;for(i=0;i<n;i++){waypoints[i]={location:locations[i]}}}var rendererOptions={draggable:draggable};var dirDisplay=new google.maps.DirectionsRenderer(rendererOptions);var dirService=new google.maps.DirectionsService();dirDisplay.setMap(null);if(!g.isUndefined(dirPanel))dirDisplay.setPanel(document.getElementById(dirPanel));dirDisplay.setMap(g.map);var request={origin:origin,destination:destination,travelMode:mode,optimizeWaypoints:true,avoidHighways:avoidHighways,avoidTolls:avoidTolls,unitSystem:google.maps.UnitSystem.METRIC,waypoints:waypoints};dirService.route(request,function(response,status){if(status==google.maps.DirectionsStatus.OK){dirDisplay.setDirections(response)}});g.__dirDisplays.push(dirDisplay);return dirDisplay},getNavs:function(){return this.__dirDisplays},clearNav:function(){this.__dirDisplays.clearItem()}}